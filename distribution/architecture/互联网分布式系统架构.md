[TOC]

# 互联网分布式系统架构

### 演进之路

1. 网站一开始就是大型的吗？
2. 我们应该一开始就设计一个大型网站吗？

#### 初生

无名的小网站->访问量低，一台服务器满足需求。

典型的技术LAMP：Linux+Apache+MySQL+PHP

![image-20190922103850296](assets/image-20190922103850296.png)

#### 发展问题

随着网站业务的发展，越来越多的用户访问，面临的问题：

* 性能越来越差。
* 越来越多的数据导致存储空间不足。

#### 应用服务与数据服务分离

![image-20190922103925372](assets/image-20190922103925372.png)

服务器对应不同的硬件需求。

应用服务器：需要更快更强大的CPU来处理业务逻辑。

数据库服务器：需要更快的硬盘和更大的内存来快速磁盘检索和数据缓存。

文件服务器：需要更大的硬盘来存储大量用户上传的文件。

不同的服务器承担不同的服务角色。并发处理能力和数据存储空间得到提升，应用程序的性能提升。

#### 发展问题

随着用户逐渐增多，网站再次面临挑战。数据库压力太大导致访问延迟，进而影响整个网站的性能，用户体验收到影响。

#### 使用缓存改善性能

![image-20190922104003932](assets/image-20190922104003932.png)

#### 发展问题

随着用户逐渐增多，单一应用服务器面临新的问题。

能够处理的请求连接有限，网站访问高峰期，应用服务器成为整个网站的瓶颈。

![image-20190922104212861](assets/image-20190922104212861.png)

![image-20190922104234157](assets/image-20190922104234157.png)

#### 发展问题

使用缓存后，虽然大大减轻了数据库的压力，但是面临新的问题。

有一部分读操作，缓存访问不命中，缓存过期和全部的写操作要访问数据库，当用户达到一定的规模后，数据库因为负载压力过高而成为整个系统的瓶颈。

![image-20190922104526974](assets/image-20190922104526974.png)

![image-20190922104543940](assets/image-20190922104543940.png)

#### 发展问题

用户规模越来越大，发布地狱越来越广，地域网络环境差别很大，面临问题。

如何保证用户的访问体验，不至于因访问慢而丢失用户。

#### 反向代理和CDN加速

![image-20190922104816462](assets/image-20190922104816462.png)

加快用户访问响应速度，减轻后端服务器的负载压力。

#### 发展问题

单文件服务器，单数据库服务器，面临问题。存不下日益增长的数据。

#### 分布式文件系统和分布式数据库系统

![image-20190922105140250](assets/image-20190922105140250.png)

![image-20190922105203603](assets/image-20190922105203603.png)

#### 发展问题

随着业务的发展，数据的存储需求和检索需求越来越复杂，面临新问题。存储的字段差异较大，出现骷髅表。复杂的文本检索。

#### 使用NoSQL，搜索引擎

![image-20190922112529725](assets/image-20190922112529725.png)

![image-20190922112547811](assets/image-20190922112547811.png)

#### 发展问题

网站越来越好，业务不断扩大，越来越复杂，面临新问题。应用程序将变得无比庞大，迭代周期越来越快，牵一发而动全身，怎么应对快速的业务发展需要？

### 业务拆分

![image-20190922112821870](assets/image-20190922112821870.png)

![image-20190922112844935](assets/image-20190922112844935.png)

#### 发展问题

业务规模不断增大，应用拆分越来越小，越来越多，面临新问题。

应用间的关系越来越复杂，应用中存在大量相同的业务操作。

后端的数据库要被成千上万台应用服务器连接，数据库连接资源不足。

#### 分布式服务，服务化

![image-20190922113125867](assets/image-20190922113125867.png)

![image-20190922113149489](assets/image-20190922113149489.png)

![image-20190922113204576](assets/image-20190922113204576.png)

#### 发展问题

随着业务的发展，系统的规模的不断增大，出现数据挖掘，分析，推荐等业务需求，庞大系统的监控，问题分析等需求。

#### 大数据技术，监控，日志分析系统

![image-20190922113416782](assets/image-20190922113416782.png)

![image-20190922113438934](assets/image-20190922113438934.png)

### 架构设计思想

1. 分而治之。
2. 随网站所需灵活应对。
3. 业务发展驱动技术发展，技术发展反哺业务。
4. 软件系统的价值在于它能为用户提供什么价值，在于网站能做什么，而不在于它是怎么做的。

### 架构设计误区

1. 一味追随大公司的解决方案。
2. 为了技术而技术。
3. 企图用技术解决所有问题。
4. 技术是用来解决业务问题的，而业务问题，也可以通过业务手段来解决。12306分时售票。

