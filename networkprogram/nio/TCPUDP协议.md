# TCP/UDP协议

### OSI七层网络模型

为使不同计算机厂家的计算机能够互相通信，以便在更大范围内建立计算机网络，有必要建立一个国际范围的网络体系结构标准。

![1556716070009](C:\Users\zhu\AppData\Roaming\Typora\typora-user-images\1556716070009.png)

### 各层的主要功能

1. 物理层：使原始数据比特流能在物理介质上传输。
2. 数据链路层：通过校验，确认和反馈重发等手段，形成稳定的数据链路。
3. 网络层：进行路由和流量控制。(IP协议)。
4. 传输层：提供可靠的端口到端口的数据传输协议(TCP/UDP协议)。
5. 会话层：负责建立，管理和终止进程之间的会话和数据交换。
6. 表示层：负责数据格式转换，数据加密和解密，压缩与解压缩等。
7. 应用层：为用户的应用进程提供网络服务。

物理层，数据链路层和网络层统称为低三层。传输层起承上启下的作用。会话层，表示层和应用层统称为高三   层。

### 传输控制协议TCP

传输控制协议(TCP)是Internet一个重要的传输层协议。TCP面向连接，可靠，有序，字节流传输服务。应用程序在使用TCP之前，必须先建立TCP连接。

![1556716666023](C:\Users\zhu\AppData\Roaming\Typora\typora-user-images\1556716666023.png)

### TCP握手机制

![1556716755394](C:\Users\zhu\AppData\Roaming\Typora\typora-user-images\1556716755394.png)

1. 三次握手为什么客户端最后还要发一次确认呢？

   主要是为了防止已经失效的连接请求报文段突然又传到了服务端，因而产生错误。

2. 四次挥手为什么客户端要等待一段时间即2MSL(最大报文段寿命)，才关闭连接？

   为了保证客户端发送的最后一个ACK报文段能够到达服务端。

   防止已经失效的连接请求报文段出现在本连接中。

### 用户数据报协议UDP

用户数据报协议UDP是Internet传输层协议。提供无连接，不可靠，数据报尽力传输服务。

开发应用人员在UDP上构建应用，关注一下几点：

1. 应用进程更容易控制发送什么数据以及何时发送(无需建立连接)。
2. 无需建立连接。
3. 无连接状态。
4. 首部开销小。

![1556718941579](C:\Users\zhu\AppData\Roaming\Typora\typora-user-images\1556718941579.png)

### UDP和TCP比较

|     TCP      |    UDP     |
| :----------: | :--------: |
|   面向连接   |   无连接   |
| 提供可靠保证 |   不可靠   |
|      慢      |     块     |
|  资源占用多  | 资源占用少 |

### Socket编程

1. Internet中应用最广泛的网络应用编程接口，实现与三种底层协议接口：

   数据报类型套接字SOCK_DGRAM(面向UDP接口)。

   流式套接字SOCK_STREAM(面向TCP接口)。

   原始套接字SOCK_RAW(面向网络层协议接口IP，ICMP等)。

2. 主要socket API调用过程

   ![1556719564120](C:\Users\zhu\AppData\Roaming\Typora\typora-user-images\1556719564120.png)
   
3. Socket API函数定义

   listen()，accept()函数只能用于服务器端。

   connect()函数只能用户客户端。

   socket()，bind()，send()，recv()，sendto()，recvfrom()，close()










